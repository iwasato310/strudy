# 📘 UMLクラス図 関係まとめ（Engineer Edition）

> 実務設計・レビュー観点を含めたUMLクラス図の関係整理

---

## 📑 目次

- [1. 関係一覧](#1-関係一覧)
- [2. 各関係の詳細](#2-各関係の詳細)
  - [関連（Association）](#関連association)
  - [集約（Aggregation）](#集約aggregation)
  - [コンポジション（Composition）](#コンポジションcomposition)
  - [依存（Dependency）](#依存dependency)
  - [汎化（Generalization）](#汎化generalization)
  - [実現（Realization）](#実現realization)
- [3. 設計レビュー観点](#3-設計レビュー観点)
- [4. 記号と方向まとめ](#4-記号と方向まとめ)

---

# 1. 関係一覧

| 種類 | UML記法 | 意味（厳密） | ライフサイクル | ナビゲーション | 代表例 |
|------|----------|--------------|----------------|----------------|--------|
| 関連 (Association) | 実線 | 構造的関係 | 独立 | 片方向/双方向指定可 | Order ― Customer |
| 集約 (Aggregation) | ◇― 実線 | 共有の全体‐部分関係 | 独立 | 全体→部分 | Team ◇― Member |
| コンポジション (Composition) | ◆― 実線 | 強い全体‐部分関係 | 部分は全体に従属 | 全体→部分 | House ◆― Room |
| 依存 (Dependency) | 点線→ | 一時的利用関係 | なし | 依存元→依存先 | Service → Repository |
| 汎化 (Generalization) | 実線＋白三角 | 継承（is-a） | 子は親型へ代入可 | 子→親 | Dog ▷ Animal |
| 実現 (Realization) | 点線＋白三角 | Interface実装 | 契約遵守 | 実装→Interface | FileRepo ▷ IRepository |

---

# 2. 各関係の詳細

---

## 関連（Association）

### 定義
クラス間の構造的関係。インスタンス間にリンクが存在する。

### 記法例

Order ───── Customer

### 実務ポイント

- 多重度（1, 0..*, 1..1）を必ず明示
- 双方向関連は循環参照リスクあり
- ORマッパー使用時はパフォーマンス影響あり

---

## 集約（Aggregation）

### 定義
共有集約。部分は独立したライフサイクルを持つ。

### 記法例

Team ◇──── Member

### 実務ポイント

- UML仕様上は意味が弱い
- 実務では単なる関連と同義になることが多い
- DDDでは明確に区別しないケースが多い

---

## コンポジション（Composition）

### 定義
強い所有関係。部分は全体と運命を共にする。

### 記法例

House ◆──── Room

### 特徴

- 部分は単一所有
- ライフサイクル従属
- 共有不可

### 設計観点

- Aggregate内部構造の表現に有効
- 外部から差し替え不可が原則
- 生成責任を全体側が持つ

---

## 依存（Dependency）

### 定義
一時的利用関係。構造的保持はしない。

### 記法例

Controller - - - - > Service

### 発生箇所

- メソッド引数
- ローカル変数
- static参照
- 例外型

### 設計観点

- 依存は必ず抽象へ向ける（DIP）
- 依存方向＝変更影響方向

---

## 汎化（Generalization）

### 定義
継承関係。is-a関係が成立する場合にのみ使用。

### 記法例

Dog ─────▷ Animal

### 設計原則

- LSP遵守必須
- 契約強化禁止
- 例外仕様変更禁止
- 継承は振る舞いの一般化

---

## 実現（Realization）

### 定義
Interfaceの契約を実装する関係。

### 記法例

FileRepository - - - - ▷ IRepository

### 設計観点

- DIPの中心
- テスト容易性向上
- ポリモーフィズム実現

---

# 3. 設計レビュー観点

- 継承は本当に is-a か？
- コンポジションにできないか？
- 依存は抽象へ向いているか？
- 双方向関連は必要か？
- 多重度は明示されているか？
- Aggregate境界は適切か？

---

# 4. 記号と方向まとめ

| 関係 | 記号 | 向き | 本質 |
|------|------|------|------|
| 関連 | ─ | 任意 | 構造リンク |
| 集約 | ◇── | ◇は全体側 | 弱い所有 |
| コンポジション | ◆── | ◆は全体側 | 強い所有 |
| 依存 | - - - → | 依存元→依存先 | 一時利用 |
| 汎化 | ───▷ | 子→親 | 型一般化 |
| 実現 | - - - ▷ | 実装→Interface | 契約実装 |

---

# 🎯 実務設計の結論

- 継承よりコンポジション
- 依存は抽象へ
- コンポジションはライフサイクル拘束が本質
- 関連は最小限に
- 双方向は原則避ける
